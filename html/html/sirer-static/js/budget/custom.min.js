(function(e,c){var a=100000000000000;var d=[];var f=[];f[1]=[];f[2]=[];var b=[];e.axmr={};e.axmr.guid=function(g,h,j){if(e.isPlainObject(g)||e.isArray(g)){currGuid=-1;if(g.guid){currGuid=g.guid}else{var i=function(l,k){currGuid=k;return(l===g)};e.grep(d,i)}if(currGuid==-1){currGuid=++a;g.guid=currGuid;d[currGuid]=g}if(g.id){b[g.id]=currGuid}if(h!==undefined){f[1][currGuid]=h}if(j!==undefined){f[2][currGuid]=j}return currGuid}else{return d[g]}};e.axmr.getAllElements=function(){return d};e.axmr.label=function(g,h){if(!d[g]){return g}if(!h){h=1}if(f[h][g]===undefined){return""}return f[h][g]};e.axmr.searchById=function(g){return b[g]};e.axmr.getById=function(g){return d[b[g]]};e.axmr.deselectGrid=function(g){e(g).handsontable("deselectCell");setTimeout(function(){e(g).handsontable("deselectCell")},500)}})(jQuery);var isClosed=false;var lastCostRow,lastCostCol;var markup=0;var pazienti=0;var quickSave=false;var approvedMetadata=new Array("Prestazioni_CDC","Prestazioni_UOC","Tariffario_Solvente","Tariffario_SSN","TimePoint_Descrizione","TimePoint_NumeroVisita","TimePoint_Tempi","TimePoint_DurataCiclo","Ricovero_Ordinario","Ricovero_Straordinario","Ricovero_Ambulatoriale","Ricovero_Telefonico","TimePoint_Note","tp-p_Checked","tp-p_TimePoint","tp-p_Prestazione","Rimborso_Rimborsabilita");var costiInit=false;var tariffarioAlpi=new Array();var tariffarioSSN=new Array();var dizPrestazioni=new Array();var folderTp=null;var folderPrestazioni=null;var folderTpxp=null;var folderPxp=null;var folderPxs=null;var folderBudgetStudio=null;var folderPxsCTC=null;var folderPxpCTC=null;var folderPassthroughCTC=null;var rowAltro=null;var totalePaziente=0;var totaleStudio=0;var hidebutton=function(){if($("#dizionario").val()){$("#Prestazioni_Altro").hide()}else{$("#Prestazioni_Altro").show()}};$(document).ready(function(){$("input[type=text]").on("keyup",function(b){var a=$(this).val();var c=$.trim(a).replace(/,/,".");if(isNaN(a)&&!isNaN(c)){$(this).val(c)}});$("#Prestazioni_prestazione").change(hidebutton).keypress(hidebutton);$("#Prestazioni_CDC").change(hidebutton).keypress(hidebutton);$("#Prestazioni_Altro").hide()});function newBudgetStudio(b){var a=$.extend(true,{},emptyBudgetCTC);a=formToElement(b,a);loadingScreen("Salvataggio in corso...","CPRMS/app/int/images/loading.gif");$.when(saveElement(a,folderBudgetStudio)).then(function(c){window.location.href="../custom/budget_studio/"+c.ret})}function compareBudgetStudio(){var b=$("[name=confronto1]:checked").val();var a=$("[name=confronto2]:checked").val();if(!b||!a||b==a){alert("Selezionare i budget da confrontare");return}location.href="../custom/budgetcompare/"+folderBudgetStudio+"?confronto1="+b+"&confronto2="+a}function openClone(b,a){if(a){$("#clone_id2").val(b);$("#clone2-dialog-form").dialog("open")}else{$("#clone_id").val(b);$("#clone-dialog-form").dialog("open")}}function cloneObj(d,c,a){loadingScreen("Salvataggio in corso...","${baseUrl}/int/images/loading.gif");var b="../../rest/documents/"+d+"/defaultClone";console.log(c);$.ajax({type:"GET",url:b,data:c,success:function(e){if(e.result=="OK"){if($("#container:checked").size()>0){$("#isContainer").show()}else{$("#isContainer").hide()}loadingScreen("Clonazione effettuata","../../int/images/green_check.jpg",2000);if(e.redirect){if(a){window.location.href=e.redirect}else{window.location.href="../custom/budget_studio/"+e.ret}}}else{loadingScreen("Errore clonazione!","../../int/images/alerta.gif",3000)}},error:function(){loadingScreen("Errore clonazione!","../../int/images/alerta.gif",3000)}})}function salvaPrestazione(b){var c={};var a=$(b).closest("form").find(":input");a.each(function(){c[this.name]=this.value});c["new"]="true";$.ajax({method:"post",url:"/dizionari/prestazioni.php",data:c}).done(function(){alert("Prestazione salvata")})}function prepareElementForPost(a){a=$.extend(true,{},a);$.each(a,function(c,b){if(b===null||b===undefined){a[c]=""}else{if(!$.isPlainObject(b)&&!$.isArray(b)){a[c]=b.toString()}}});if(a.metadata){a.metadata=prepareMetadataForPost(a.metadata)}return a}function saveGrid(){var c=$.extend(true,[],$("#example").data("handsontable").getData());var e=$.extend(true,{},$.axmr.getAllElements());var b={};var f={x:"tp-p_TimePoint",y:"tp-p_Prestazione",row:"Prestazioni_row",col:"TimePoint_col"};b[emptyTimePoint.type.id]=folderTp;b[emptyPrestazione.type.id]=folderPrestazioni;b[emptytpxp.type.id]=folderTpxp;$.each(c,function(h,g){$.each(g,function(i,j){if(j){c[h][i]=j.toString()}})});$.each(e,function(g,h){e[g]=prepareElementForPost(h)});b=prepareElementForPost(b);var a=$.extend(true,{},{layout:c,elements:e,folders:b,coordinates:f});var d={grid:JSON.stringify(a)};return $.ajax({method:"POST",url:"../../rest/documents/updateGrid",data:d})}function prepareTargetForm(c){var a="";var b;if(c){if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget)){b=docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget[0]}else{b=docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget}if(!b){b=1}$("#target").val(b)}else{b=$("#target").val()}b+="";switch(b){case"1":$.each(docObj.elements.tp,function(f,i){var g="";var e="";var h;if(docObj.elements.target[i.id]){h=docObj.elements.target[i.id]}else{h=$.extend(true,{},emptyPrezzoPrestazione);h.metadata.PrezzoFinale_Prestazione[0]=i;docObj.elements.target[i.id]=h}if($.isArray(h.metadata.PrezzoFinale_Prezzo)){g=h.metadata.PrezzoFinale_Prezzo[0]}else{g=h.metadata.PrezzoFinale_Prezzo}if($.isArray(i.metadata.TimePoint_Descrizione)){e=i.metadata.TimePoint_Descrizione[0]}else{e=i.metadata.TimePoint_Descrizione}if(g==undefined){g=""}if(e==undefined){e=""}e="<label>"+e+"</label>";a+=e+'<input type="text" value="'+g+'" name="target_tp_'+f+'" />'});break;case"2":var d="";if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente)){d=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente[0]}else{d=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente}if(d==undefined){d=""}a='<input type="text" value="'+d+'" name="targetPrezzo" />';break;case"3":if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio)){d=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio[0]}else{d=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio}if(d==undefined){d=""}a='<input type="text" value="'+d+'" name="targetPrezzo" />';break}$("#target-form").html(a)}function applyTargetForm(){if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget)){docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget[0]=$("#target").val()}else{docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget=$("#target").val()}if($("#target").val()!="1"){$.each(docObj.elements.target,function(a,b){if($.isArray(b.metadata.PrezzoFinale_Prezzo)){b.metadata.PrezzoFinale_Prezzo[0]=""}else{b.metadata.PrezzoFinale_Prezzo=""}})}if($("#target").val()!="2"){if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente)){docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente[0]=""}else{docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente=""}}if($("#target").val()!="3"){if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio)){docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio[0]=""}else{docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio=""}}switch($("#target").val()){case"1":$.each(docObj.elements.tp,function(a,c){var b;if(docObj.elements.target[c.id]){b=docObj.elements.target[c.id]}else{b=$.extend(true,{},emptyPrezzoPrestazione);b.metadata.PrezzoFinale_Prestazione[0]=c;docObj.elements.target[c.id]=b}if($.isArray(b.metadata.PrezzoFinale_Prezzo)){b.metadata.PrezzoFinale_Prezzo[0]=$("input[name=target_tp_"+a+"]").val()}else{b.metadata.PrezzoFinale_Prezzo=$("input[name=target_tp_"+a+"]").val()}});break;case"2":if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente)){docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente[0]=$("input[name=targetPrezzo]").val()}else{docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente=$("input[name=targetPrezzo]").val()}break;case"3":if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio)){docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio[0]=$("input[name=targetPrezzo]").val()}else{docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio=$("input[name=targetPrezzo]").val()}break}}function buildTpDescription(f){var b=prepareMetadataForPost(f.metadata);var a=new Array();a.Ricovero_Ordinario="ORD.";a.Ricovero_Straordinario="EXTRA.";a.Ricovero_Ambulatoriale="AMB.";a.Ricovero_Telefonico="TEL.";var d="";for(var e in a){if(b[e]){d+=a[e]+"\n"}}var c=b.TimePoint_Descrizione+"\n";if(b.TimePoint_NumeroVisita){c=b.TimePoint_NumeroVisita+" - "+c}if(b.TimePoint_Tempi){c+="Tempi: "+b.TimePoint_Tempi+"\n"}if(b.TimePoint_DurataCiclo){c+="Durata: "+b.TimePoint_DurataCiclo+"\n"}if(d){c+="Ricovero: "+d}return c}function clone(e){function b(g,m,j){var f,k,h,l={};for(f in m){k=m[f];if(!(f in g)||(g[f]!==k&&(!(f in l)||l[f]!==k))){g[f]=j?j(k):k}}return g}if(!e||typeof e!="object"||Object.prototype.toString.call(e)==="[object Function]"){return e}if(e.nodeType&&"cloneNode" in e){return e.cloneNode(true)}if(e instanceof Date){return new Date(e.getTime())}if(e instanceof RegExp){return new RegExp(e)}var d,c,a;if(e instanceof Array){d=[];for(c=0,a=e.length;c<a;++c){if(c in e){d.push(clone(e[c]))}}}else{d=e.constructor?new e.constructor():{}}return b(d,e,clone)}function loadData(d,g,m){$("#TPS").empty();$("#COSTS").empty();if(m){docObj=m}var f="";var n="";for(var e=0;e<d.length;e++){if(e==0){for(var a=0;a<d[0].length;a++){if(a!=0){var j=d[0][a];if(j===undefined||j===null||j===""){j="Timepoint non specificato";f+='<li class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>'+j+'<input type="hidden" name="position_col[]" value="'+a+'"></li>'}else{var l=f+'<li class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>'+j+'<input type="hidden" name="position_col[]" value="'+a+'"></li>';f="";$("#TPS").append(l)}}}}else{var j=d[e][0];if(j===undefined||j===null||j===""){j="Costo non specificato";n+='<li class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>'+j+'<input type="hidden" name="position_row[]" value="'+e+'"></li>'}else{var l=n+'<li class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>'+j+'<input type="hidden" name="position_row[]" value="'+e+'"></li>';n="";$("#COSTS").append(l)}}}var c=$("#example").data("handsontable");if(c){c.loadData(d)}if(g&&docObj.elements.tpxp.length>0){costiInit=true;var h=migrateData(d);var b=$("#costi").data("handsontable");if(b){b.loadData(h);if(c){loadCosti()}else{loadPrezzi()}}}}function migrateData(f){var j=clone(f);var l=new Array();var b=new Array();var e=0;var a=0;var m=0;for(var d=1;d<j.length;d++){var g=0;if(j[d][0]!==undefined&&j[d][0]!==null&&$.trim(j[d][0])!=""){m=d}for(var c=1;c<j[d].length;c++){var h=$.trim(j[d][c]);if(h&&h!="false"){if(docObj.elements.tpxp2update[d]&&docObj.elements.tpxp2update[d][c]){j[d][c]=docObj.elements.tpxp2update[d][c].metadata.Costo_TransferPrice}if(b[d]===null||b[d]===undefined){b[d]=0}if(!isNaN(j[d][c])){b[d]+=parseFloat(j[d][c])}if(c>a){a=c}if(l[c]===null||l[c]===undefined){l[c]=0}if(!isNaN(j[d][c])){l[c]+=parseFloat(j[d][c])}}else{j[d][c]=""}}}return j}function mergeData(a,h){var o=clone(h);var n=clone(a);var q=new Array();var c=new Array();var g=0;var b=0;var p=0;q[0]="Totale per visita";c[0]="Totale per prestazione";totCounts[0]="Totale occorrenze";for(var f=1;f<o.length;f++){var l=0;var d=0;if(o[f][0]!==undefined&&o[f][0]!==null&&$.trim(o[f][0])!=""){p=f}for(var e=1;e<o[f].length;e++){var m=$.trim(o[f][e]);if(m&&m!="false"){d++;o[f][e]="0";if(c[f]===null||c[f]===undefined){c[f]=0}if(!isNaN(o[f][e])){c[f]+=parseFloat(o[f][e])}if(e>b){b=e}if(q[e]===null||q[e]===undefined){q[e]=0}if(!isNaN(o[f][e])){q[e]+=parseFloat(o[f][e])}}else{o[f][e]=""}}totCounts[f]=d}b=b+1;p=p+1;for(var j=0;j<p;j++){o[j][b]=c[j];o[j][b+1]=c[j];if(!isNaN(c[j])){g+=c[j]}}q[b]=g;o[p]=q;return o}function totaleSSN(){var a=0;$.each(docObj.elements.tpxp2update,function(c,b){if(b){$.each(b,function(e,f){if(f&&f.metadata&&f.metadata.Rimborso_Rimborsabilita){if(($.isArray(f.metadata.Rimborso_Rimborsabilita)&&f.metadata.Rimborso_Rimborsabilita[0]==2)||f.metadata.Rimborso_Rimborsabilita==2){if($.isArray(f.metadata["tp-p_Prestazione"])){if($.isArray(docObj.elements.prestazioni[f.metadata["tp-p_Prestazione"][0]].metadata.Base_Nome)){var d=tariffarioSSN[docObj.elements.prestazioni[f.metadata["tp-p_Prestazione"][0]].metadata.Base_Nome[0]]}else{var d=tariffarioSSN[docObj.elements.prestazioni[f.metadata["tp-p_Prestazione"][0]].metadata.Base_Nome]}}else{var d=tariffarioSSN[f.metadata["tp-p_Prestazione"]]}a+=parseFloat(d)}}})}});a=a.toFixed(2)}function mostraTotCTC(d,m,o,k,n,c,l,a,j,p,i,h){console.log(arguments);$("#table-tot tbody").empty();if(isNaN(o)){o=0;k=0}if(isNaN(n)){n=0;c=0}if(isNaN(l)){l=0;a=0}if(isNaN(j)){j=0;p=0}if(isNaN(i)){i=0;h=0}var b=parseFloat(d)+parseFloat(o)+parseFloat(l);var f=parseFloat(m)+parseFloat(k)+parseFloat(a);totalePaziente=b;if(pazienti>0){var e=(b*pazienti)+parseFloat(n)+parseFloat(j)+parseFloat(i);var q=(f*pazienti)+parseFloat(c)+parseFloat(p)+parseFloat(h);q=q.toFixed(2);totaleStudio=e}else{var e="Definire il numero di pazienti";var q="Definire il numero di pazienti"}var g="";g+="<tr><td>Budget totale per paziente</td><td>"+b+"</td><td>"+f+"</td></tr>";g+="<tr><td>Budget totale per studio</td><td>"+e+"</td><td>"+q+"</td></tr>";docObj.elements.budgetStudio.metadata.BudgetCTC_TotaleFlowchart=d;docObj.elements.budgetStudio.metadata.BudgetCTC_TotaleFlowchartCTC=m;docObj.elements.budgetStudio.metadata.BudgetCTC_TotalePaziente=b;docObj.elements.budgetStudio.metadata.BudgetCTC_TotalePazienteCTC=f;docObj.elements.budgetStudio.metadata.BudgetCTC_TotaleStudio=e;docObj.elements.budgetStudio.metadata.BudgetCTC_TotaleStudioCTC=q;$("#table-tot tbody").html(g);$("#markup-ins").html(markup+"%")}function rimuoviTotali(){var d=$("#costi").data("handsontable");var h=d.getData();var o=clone(h);var p=new Array();var b=new Array();var g=0;var a=0;var q=0;var j=false;var f=false;p[0]="Totale per visita";b[0]="Totale per prestazione";for(var e=1;e<o.length;e++){var m=0;if(o[e][0]=="Totale per visita"){f=true;q=e}for(var c=1;c<o[e].length;c++){var n=$.trim(o[e][c]);if((c<a||a==0)&&(e<q||q==0)){if(n&&n!="false"){if(o[0][c]=="Totale per prestazione"){j=true;a=c;continue}}}}}if(j){for(var l=0;l<o.length;l++){if(o[l][a]){o[l][a]=""}if(o[l][a+1]){o[l][a+1]=""}}}if(f){o[q]=new Array();o[q+1]=new Array();o[q+2]=new Array();o[q+3]=new Array()}d.loadData(o);$(".tot-costi").remove();return true}function cleanCost(a){$.each(a.metadata,function(b,c){if(b.match(/^costo_/i)){if($.isArray(c)){c[0]=""}else{a.metadata[b]=""}}});$.axmr.guid(a,undefined,"")}function updatePrezzi(e){array=baseData;var b=clone(array);for(var f=1;f<b.length;f++){var a=0;for(var d=1;d<b[f].length;d++){var h=$.axmr.guid(b[f][d]);if($.isPlainObject(h)){var g=getDato(getDato(h.metadata.PrezzoFinale_Prestazione).metadata.Costo_TransferPrice)-0;g=g+(g*e/100);h.metadata.PrezzoFinale_Prezzo=g;b[f][d]=$.axmr.guid(h,1,g)}}}$.each(docObj.elements.prezzi,function(k,j){var l=getDato(j.metadata.PrezzoFinale_Prestazione).type.typeId;switch(l){case"tpxp":break;case"PrestazioneXStudio":case"PrestazioneXPaziente":var m=getDato(getDato(h.metadata.PrezzoFinale_Prestazione).metadata.Costo_TransferPrice)-0;m=m+(m*e/100);j.metadata.PrezzoFinale_Prezzo=m;updatePrezzoTD(m,k);break}});var c=$("#costi").data("handsontable");c.loadData(b)}function getTpTarget(b){var a;if(docObj.elements.target[b.id]){a=docObj.elements.target[b.id]}else{a=$.extend(true,{},emptyPrezzoPrestazione);a.metadata.PrezzoFinale_Prestazione[0]=val;docObj.elements.target[b.id]=a}return getDato(a.metadata.PrezzoFinale_Prezzo)}function calcolaTotali(){var w=$("#costi").data("handsontable");var x=$("#example").data("handsontable");if(x){var m=x.getData()}else{if(baseData){m=baseData}}var o=clone(m);var d=new Array();var C=new Array();var I=new Array();var u=0;var t=0;var y=0;var K=false;var c=false;markup=0;if(docObj.elements.budgetStudio.metadata){markup=docObj.elements.budgetStudio.metadata.BudgetCTC_Markup}pazienti=docObj.elements.budgetStudio.metadata.BudgetCTC_NumeroPazienti;elementToForm(docObj.elements.budgetStudio,"dialog-form-CTC");elementToForm(docObj.elements.budgetStudio,"dialog-form-n-pat");d[0]="Totale per visita";C[0]="Totale per prestazione";I[0]="Totale occorrenze";if(budgetCTC){var g=getDato(docObj.elements.budgetStudio.metadata.BudgetCTC_TipoTarget)}else{budgetCTC=false}if(g){g+="";$("#target").val(g);var r=0;var F=0;var s=0;var A=0;var b="";switch($("#target").val()){case"1":b="Per visita";$.each(docObj.elements.tp,function(i,z){var k;if(docObj.elements.target[z.id]){k=docObj.elements.target[z.id]}else{k=$.extend(true,{},emptyPrezzoPrestazione);k.metadata.PrezzoFinale_Prestazione[0]=z;docObj.elements.target[z.id]=k}if($.isArray(k.metadata.PrezzoFinale_Prezzo)){F=k.metadata.PrezzoFinale_Prezzo[0]}else{F=k.metadata.PrezzoFinale_Prezzo}if(!isNaN(parseFloat(F))){r+=parseFloat(F)}});break;case"2":b="Per paziente";if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente)){F=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente[0]}else{F=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetPaziente}r=F;break;case"3":b="Per studio";if($.isArray(docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio)){F=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio[0]}else{F=docObj.elements.budgetStudio.metadata.BudgetCTC_TargetStudio}if(!isNaN(parseFloat(F))){r=parseFloat(F)}break}}for(var L=1;L<o.length;L++){var n=0;var G=0;if(o[L][0]=="Totale per visita"){y=L;K=true}for(var J=1;J<o[L].length;J++){var q=$.axmr.guid(o[L][J]);var F=$.trim($.axmr.label(o[L][J],2));if((J<t||t==0)&&(L<y||y==0)){if(F&&F!="false"){G++;if(q&&getDato(q.metadata.Rimborso_Rimborsabilita)=="2"){cleanCost(q);F=0}if(C[L]===null||C[L]===undefined){C[L]=0}if(o[0][J]=="Totale per prestazione"){t=J;c=true;continue}if(!isNaN(F)){C[L]+=parseFloat(F)}if(d[J]===null||d[J]===undefined){d[J]=0}if(!isNaN(parseFloat(F))){d[J]+=parseFloat(F)}}}}I[L]=G}if(!K){for(var D=1;D<o.length;D++){var e=$.trim($.axmr.label(o[D][0]));if(o[D+1]&&o[D+1][0]){var f=$.trim($.axmr.label(o[D+1][0]))}else{var f=""}if(e!=""&&f==""){y=D+1}}}if(!c){for(var N=1;N<o[0].length;N++){var e=$.trim($.axmr.label(o[0][N]));if(o[0]&&o[0][N+1]){var f=$.trim($.axmr.label(o[0][N+1]))}else{var f=""}if(e!=""&&f==""){t=N+1}}}for(var E=0;E<y;E++){o[E][t]=C[E];o[E][t+1]=I[E];if(!isNaN(C[E])){u+=C[E]}}d[t]=u;o[y]=d;markup=parseFloat(markup);var v=(g&&$("#target").val()==1);if(!o[y+1]){o[y+1]=new Array()}if(!o[y+2]){o[y+2]=new Array()}if(!o[y+3]){o[y+3]=new Array()}if(markup>0&&budgetCTC&&false){o[0][t+1]="Valore con markup";o[y+1][0]="Valore con markup";if(v){o[y+2][0]="Valore target";o[y+3][0]="Target markup"}for(var D=1;D<y;D++){if(o[D][t]>0){o[D][t+1]=(o[D][t]*((100+markup)/100)).toFixed(2)}}for(var N=1;N<t;N++){if(o[y][N]>0){o[y+1][N]=(o[y][N]*((100+markup)/100)).toFixed(2)}if(v){var a=parseFloat(getTpTarget(docObj.elements.tp[N-1]));if(o[y][N]>0){o[y+2][N]=a;o[y+3][N]=((a-o[y][N])*100/o[y][N]).toFixed(2)}else{o[y+2][N]=a;o[y+3][N]="N.A."}}else{o[y+2][N]="";o[y+3][N]=""}}if(o[y][t]>0){var B=o[y][t];var O=o[y][t+1]=o[y+1][t]=(o[y][t]*((100+markup)/100)).toFixed(2);if(v){o[y+2][t]=r;if(B>0){o[y+3][t]=((r-B)*100/o[y][N]).toFixed(2)}else{o[y+3][t]="N.A."}}else{o[y+2][t]=r}}else{var B=0;var O=0}var M=new Array();var h=new Array();for(var l=1;l<=5;l++){var j=M[l]=parseFloat($("#tot_costi_"+l).html());$("#costo-ctc-mu-"+l).remove();if(j>0&&l!=5){var p=h[l]=(j*((100+markup)/100)).toFixed(2);if(l==3||l==4){categoriaTot="<td></td>"}else{categoriaTot=""}$("#costs-"+l+" tbody").append("<tr id='costo-ctc-mu-"+l+"'><td>Totale con markup</td>"+categoriaTot+"<td>"+p+"</td><td></td></tr>")}else{h[l]=j}}}else{o[0][t+1]=I[0];o[y+1][0]="";if(v){o[y+1][0]="Valore target";o[y+2][0]="Target markup"}for(var D=1;D<y;D++){if(o[D][t]>0){o[D][t+1]=I[D]}}for(var N=1;N<t;N++){if(o[y][N]>0){o[y+1][N]=""}if(v){var a=parseFloat(getTpTarget(docObj.elements.tp[N-1]));if(o[y][N]>0){o[y+1][N]=a;o[y+2][N]=((a-o[y][N])*100/o[y][N]).toFixed(2)}else{o[y+1][N]=a;o[y+2][N]="N.A."}}else{o[y+2][N]=""}}if(o[y][t]>0){o[y][t+1]=o[y+1][t]=""}var M=new Array();var h=new Array();for(var l=1;l<=5;l++){$("#costo-ctc-mu-"+l).remove();M[l]=h[l]=parseFloat($("#tot_costi_"+l).html());if(!isNaN(M[l])){M[l]=0}}M[5]=h[5];var O,B;B=0;O=o[y][t];if(docObj.elements.prezzi){$.each(docObj.elements.prezzi,function(P,z){var R=getDato(z.metadata.PrezzoFinale_Prestazione);var Q=getDato(z.metadata.PrezzoFinale_Prestazione).type.typeId;switch(Q){case"tpxp":var k=getDato(R.metadata.Costo_TransferPrice);k=parseFloat(k);if(!isNaN(k)){B+=k}break;case"PrestazioneXStudio":var k=getDato(R.metadata.Costo_TransferPrice);M[2]+=k;break;case"PrestazioneXPaziente":var k=getDato(R.metadata.Costo_TransferPrice);M[1]+=k;break}})}if(docObj.elements.pxpCTC){$.each(docObj.elements.pxpCTC,function(z,P){if(P){var k=parseFloat(getDato(P.metadata.Costo_TransferPrice));console.log(k);M[3]+=k}})}if(docObj.elements.pxsCTC){$.each(docObj.elements.pxsCTC,function(z,P){if(P){var k=parseFloat(getDato(P.metadata.Costo_TransferPrice));M[4]+=k}})}if(v){o[y+1][t]=r;if(o[y][N]>0){o[y+2][t]=((r-B)*100/o[y][N]).toFixed(2)}else{o[y+2][t]="N.A."}}}mostraTotCTC((parseFloat(B)).toFixed(2),(parseFloat(O)).toFixed(2),(parseFloat(M[1])).toFixed(2),(parseFloat(h[1])).toFixed(2),(parseFloat(M[2])).toFixed(2),(parseFloat(h[2])).toFixed(2),(parseFloat(M[3])).toFixed(2),(parseFloat(h[3])).toFixed(2),(parseFloat(M[4])).toFixed(2),(parseFloat(h[4])).toFixed(2),(parseFloat(M[5])).toFixed(2),(parseFloat(h[5])).toFixed(2));if(g){g+="";switch($("#target").val()){case"1":s=u;break;case"2":s=totalePaziente;break;case"3":s=totaleStudio;break}A=(r-s)*100/s;if(!isNaN(r)&&!isNaN(A)){var H="";H="<tr><td>"+b+"</td><td>"+r+"</td><td>"+s+"</td><td>"+A.toFixed(2)+"</td></tr>";$("#table-advised-markup tbody").html(H)}}w.loadData(o);return o}function initPreventivo(d){var a=clone(d);var c=new Array();var b=new Array()}function deletePxp(a){docObj.elements.pxp2delete[docObj.elements.pxp2delete.length]=$.extend(true,{},docObj.elements.pxp[a]);delete docObj.elements.pxp[a];updateListaCosti(1);calcolaTotali()}function deletePxs(a){docObj.elements.pxs2delete[docObj.elements.pxs2delete.length]=$.extend(true,{},docObj.elements.pxs[a]);delete docObj.elements.pxs[a];updateListaCosti(2);calcolaTotali()}function deletePxpCTC(a){docObj.elements.pxp2delete[docObj.elements.pxp2delete.length]=$.extend(true,{},docObj.elements.pxpCTC[a]);delete docObj.elements.pxpCTC[a];updateListaCosti(3);calcolaTotali()}function deletePxsCTC(a){docObj.elements.pxs2delete[docObj.elements.pxs2delete.length]=$.extend(true,{},docObj.elements.pxsCTC[a]);delete docObj.elements.pxsCTC[a];updateListaCosti(4);calcolaTotali()}function deletePassthroughCTC(a){docObj.elements.pxs2delete[docObj.elements.pxs2delete.length]=$.extend(true,{},docObj.elements.passthroughCTC[a]);delete docObj.elements.passthroughCTC[a];updateListaCosti(5);calcolaTotali()}function addPrezzo(e,d,b,f,c,a){addCosto(e,d,b,f,a,c)}function addCosto(l,g,c,e,k,d){var j="";var i="";if(e!==null&&e!==undefined){e+="";console.log(e);switch(e){case"1":j="<td>Interno</td>";break;case"2":j="<td>Esterno</td>";break;default:j="<td>N.A.</td>";break}i="<td></td>"}if(g==1){if(k==undefined){var k=docObj.elements.pxp.length;docObj.elements.pxp[k]=$.extend(true,{},emptyPrestazioneXPaziente);docObj.elements.pxp[k]=formToElement("dialog-form",docObj.elements.pxp[k])}var f="deletePxp("+k+");"}else{if(g==2){if(k==undefined){var k=docObj.elements.pxs.length;docObj.elements.pxs[k]=$.extend(true,{},emptyPrestazioneXStudio);docObj.elements.pxs[k]=formToElement("dialog-form",docObj.elements.pxs[k])}var f="deletePxs("+k+");"}else{if(g==3){if(k==undefined){var k=docObj.elements.pxpCTC.length;docObj.elements.pxpCTC[k]=$.extend(true,{},emptyPrestazioneXPaziente);docObj.elements.pxpCTC[k]=formToElement("dialog-form-cost-2",docObj.elements.pxpCTC[k])}var f="deletePxpCTC("+k+");"}else{if(g==4){if(k==undefined){var k=docObj.elements.pxsCTC.length;docObj.elements.pxsCTC[k]=$.extend(true,{},emptyPrestazioneXStudio);docObj.elements.pxsCTC[k]=formToElement("dialog-form-cost-2",docObj.elements.pxsCTC[k])}var f="deletePxsCTC("+k+");"}else{if(g==5){if(k==undefined){var k=docObj.elements.passthroughCTC.length;docObj.elements.passthroughCTC[k]=$.extend(true,{},emptyPrestazioneXStudio);docObj.elements.passthroughCTC[k]=formToElement("dialog-form-cost-2",docObj.elements.passthroughCTC[k])}var f="deletePassthroughCTC("+k+");"}}}}}var a="#costs-"+g;$("#costo-ctc-mu-"+g).remove();$(a+" tbody tr").last().remove();var m="<td></td>";var b="";if(!isClosed&&!((g==1||g==2)&&d!==undefined)){m="<td><a href='#' onclick=\" $(this).closest('tr').remove();"+f+'return false;">X</a></td>'}else{if(d!==undefined){m="<td><a href='#' onclick=\" formPrezzo('"+g+"','"+k+"');return false;\">Modifica</a></td>";b=" id='costs-tr-"+k+"'"}}if(d){c=d}$(a+" tbody").append("<tr "+b+" ><td>"+l+"</td>"+j+"<td>"+c+"</td>"+m+"</tr>");var h=0;if(g==4||g==3){$(a+" tbody tr td:nth-child(3)").each(function(){console.log($(this));h+=parseFloat($(this).html())})}else{$(a+" tbody tr td:nth-child(2)").each(function(){console.log($(this));h+=parseFloat($(this).html())})}h=h.toFixed(2);$(a+" tbody").append("<tr class='tot-costi'><td>Totale</td>"+i+"<td id='tot_costi_"+g+"'>"+h+"</td><td></td></tr>");calcolaTotali()}function calcolaTotPerTipo(c){var d="#costs-"+c;$(d+" .tot-costi").remove();var b="";var a=0;if(c==4||c==3){b="<td></td>";$(d+" tbody tr td:nth-child(3)").each(function(){console.log($(this));a+=parseFloat($(this).html())})}else{$(d+" tbody tr td:nth-child(2)").each(function(){console.log($(this));a+=parseFloat($(this).html())})}a=a.toFixed(2);$(d+" tbody").append("<tr class='tot-costi'><td>Totale</td>"+b+"<td id='tot_costi_"+c+"'>"+a+"</td><td></td></tr>")}function calcolaTotTabelle(){for(var a=1;a<=5;a++){calcolaTotPerTipo(a)}}function updateListaCosti(b){var d="#costs-"+b;$("#costo-ctc-mu-"+b).remove();$(d+" tbody tr").last().remove();var a=0;$(d+" tbody tr td:nth-child(2)").each(function(){console.log($(this));a+=parseFloat($(this).html())});a=a.toFixed(2);var c="";if(b==4&&b==3){c="<td></td>"}$(d+" tbody").append("<tr><td>Totale</td>"+c+"<td id='tot_costi_"+b+"'>"+a+"</td><td></td></tr>")}function loadCosti(){$.each(docObj.elements.pxp,function(b,a){if(a.metadata.Base_Nome&&a.metadata.Costo_TransferPrice){addCosto(a.metadata.Base_Nome[0],1,a.metadata.Costo_TransferPrice[0],null,b)}});$.each(docObj.elements.pxs,function(b,a){if(a.metadata.Base_Nome&&a.metadata.Costo_TransferPrice){addCosto(a.metadata.Base_Nome[0],2,a.metadata.Costo_TransferPrice[0],null,b)}});$.each(docObj.elements.pxpCTC,function(b,a){if(a.metadata){if(!a.metadata.Costo_Categoria[0]){a.metadata.Costo_Categoria[0]=""}addCosto(a.metadata.Base_Nome[0],3,a.metadata.Costo_Prezzo[0],a.metadata.Costo_Categoria[0],b)}});$.each(docObj.elements.pxsCTC,function(b,a){if(a.metadata){if(!a.metadata.Costo_Categoria[0]){a.metadata.Costo_Categoria[0]=""}addCosto(a.metadata.Base_Nome[0],4,a.metadata.Costo_Prezzo[0],a.metadata.Costo_Categoria[0],b)}});$.each(docObj.elements.passthroughCTC,function(b,a){if(a.metadata.Base_Nome&&a.metadata.Costo_TransferPrice){addCosto(a.metadata.Base_Nome[0],5,a.metadata.Costo_TransferPrice[0],null,b)}});pazienti=docObj.elements.budgetStudio.metadata.BudgetCTC_NumeroPazienti;$("#show-n-pat").html(pazienti)}function loadPrezzi(){var c=new Array();var b=new Array();$.each(docObj.elements.prezzi,function(e,f){var g=getDato(f.metadata.PrezzoFinale_Prestazione);b[g.id]=e;c[g.id]=f});var a;var d;$.each(docObj.elements.pxp,function(g,f){if(f.metadata.Base_Nome&&f.metadata.Costo_TransferPrice){if(c[f.id]){a=c[f.id].metadata.PrezzoFinale_Prezzo[0];d=b[f.id]}else{d=docObj.elements.prezzi.length;var e=$.extend(true,{},emptyPrezzoPrestazione);e.metadata.PrezzoFinale_Prestazione[0]=f;docObj.elements.prezzi[d]=e;a=""}addPrezzo(f.metadata.Base_Nome[0],1,f.metadata.Costo_TransferPrice[0],null,a,d)}});$.each(docObj.elements.pxs,function(g,f){if(f.metadata.Base_Nome&&f.metadata.Costo_TransferPrice){if(c[f.id]){a=c[f.id].metadata.PrezzoFinale_Prezzo[0];d=b[f.id]}else{d=docObj.elements.prezzi.length;var e=$.extend(true,{},emptyPrezzoPrestazione);e.metadata.PrezzoFinale_Prestazione[0]=f;docObj.elements.prezzi[d]=e;a=""}addPrezzo(f.metadata.Base_Nome[0],2,f.metadata.Costo_TransferPrice[0],null,a,d)}});$.each(docObj.elements.pxpCTC,function(f,e){if(e.metadata){a=getDato(e.metadata.Costo_Prezzo);if(!e.metadata.Costo_Categoria[0]){e.metadata.Costo_Categoria[0]=""}addPrezzo(e.metadata.Base_Nome[0],3,e.metadata.Costo_Prezzo[0],e.metadata.Costo_Categoria[0],a,f)}});$.each(docObj.elements.pxsCTC,function(f,e){if(e.metadata){a=getDato(e.metadata.Costo_Prezzo);if(!e.metadata.Costo_Categoria[0]){e.metadata.Costo_Categoria[0]=""}addPrezzo(e.metadata.Base_Nome[0],4,e.metadata.Costo_Prezzo[0],e.metadata.Costo_Categoria[0],a,f)}});$.each(docObj.elements.passthroughCTC,function(f,e){if(e.metadata){a=getDato(e.metadata.Costo_TransferPrice);addPrezzo(e.metadata.Base_Nome[0],5,e.metadata.Costo_Prezzo[0],null,a,f)}});pazienti=docObj.elements.budgetStudio.metadata.BudgetCTC_NumeroPazienti;$("#show-n-pat").html(pazienti)}$(function(){var f=$("#tipologia"),l=$("#descrizione"),c=$("#costo-costo"),d=$("#markup-costo"),e=$("#transfer-costo"),i=$([]).add(f).add(l).add(c),g=$(".validateTips");function j(m){g.text(m).addClass("ui-state-highlight");setTimeout(function(){g.removeClass("ui-state-highlight",1500)},500)}function b(q,r,p,m){if(q.val().length>m||q.val().length<p){q.addClass("ui-state-error");j("Length of "+r+" must be between "+p+" and "+m+".");return false}else{return true}}function h(p,m,q){if(!(m.test(p.val()))){p.addClass("ui-state-error");j(q);return false}else{return true}}function k(){var m=true;for(var n in arguments){var p=arguments[n];if($.trim(p.val())==""){p.addClass("ui-state-error");j("Campo obbligatorio");m=false}}return m}$("#dialog-form").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi costo":function(){var m=true;i.removeClass("ui-state-error");m=m&&k(f,l,c);if(true){addCosto(l.val(),f.val(),e.val());$(this).dialog("close")}},Cancel:function(){$(this).dialog("close")}},open:function(){var q=this;var p=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:p,height:m});var o=function(){if($(q).find("select[id^=unita-markup]").val()==2){var t=parseFloat($(q).find("input[id^=costo]").val()-0);var r=t*parseFloat($(q).find("input[id^=markup]").val()-0)/100;var s=t+r}else{var s=parseFloat($(q).find("input[id^=costo]").val()-0)+parseFloat($(q).find("input[id^=markup]").val()-0)}$(q).find("input[id^=transfer]").val(s)};var n=function(){if($(q).find("input[id^=transfer]").val()>0&&$(q).find("input[id^=costo]").val()>0){$(q).find("select[id^=unita-markup]").val(1);var r=parseFloat($(q).find("input[id^=transfer]").val())-parseFloat($(q).find("input[id^=costo]").val());$(q).find("input[id^=markup]").val(r)}};$(this).find("input[id^=costo]").off("change").on("change",o);$(this).find("input[id^=markup]").off("change").on("change",o);$(this).find("select[id^=unita-markup]").off("change").on("change",o);$(this).find("input[id^=transfer]").off("change").on("change",n)},close:function(){i.val("").removeClass("ui-state-error")}});$("#create-cost").button().click(function(){$("#dialog-form").dialog("open")});$("#dialog-form-cost-2").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi costo":function(){var v=true;var r=$("#tipologia2"),u=$("#descrizione2"),n=$("#costo2"),o=$("#markup-costo2"),p=$("#transfer-costo2"),q=$("#interno_esterno"),t=$([]).add(r).add(u).add(n),s=$(".validateTips");t.removeClass("ui-state-error");v=v&&k(r,u,n);if(true){prezzo=$("#prezzo-add").val();var m=(r.val()==3||r.val()==4)?q.val():undefined;addPrezzo(u.val(),r.val(),p.val(),m,prezzo);$(this).dialog("close")}},Cancel:function(){$(this).dialog("close")}},open:function(){var p=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:p,height:m});var q=this;var o=function(){if($(q).find("select[id^=unita-markup]").val()==2){var t=parseFloat($(q).find("input[id^=costo]").val()-0);var r=t*parseFloat($(q).find("input[id^=markup]").val()-0)/100;var s=t+r}else{var s=parseFloat($(q).find("input[id^=costo]").val()-0)+parseFloat($(q).find("input[id^=markup]").val()-0)}$(q).find("input[id^=prezzo]").val(s)};var n=function(){if($(q).find("input[id^=prezzo]").val()>0&&$(q).find("input[id^=costo]").val()>0){$(q).find("select[id^=unita-markup]").val(1);var r=parseFloat($(q).find("input[id^=prezzo]").val())-parseFloat($(q).find("input[id^=costo]").val());$(q).find("input[id^=markup]").val(r)}};$(this).find("input[id^=costo]").off("change").on("change",o);$(this).find("input[id^=markup]").off("change").on("change",o);$(this).find("select[id^=unita-markup]").off("change").on("change",o);$(this).find("input[id^=prezzo]").off("change").on("change",n)},close:function(){i.val("").removeClass("ui-state-error")}});$("#create-cost-2").button().click(function(){$("#dialog-form-cost-2").dialog("open")});function a(m,o){var n=$.extend(true,{},emptyVoce);n.metadata.PrestazioniDizionario_Descrizione[0]=m;saveElement(n,folderDizionario);$("#example").handsontable("setDataAtCell",o,0,m)}$("#prestazione-dialog").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Nuova prestazione":function(){var m=$("#Altro_Descrizione").val();if(dizPrestazioni[m]){alert("Prestazione già presente nel dizionario")}else{a(m,rowAltro)}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},open:function(){},close:function(){i.val("").removeClass("ui-state-error")}});$("#tp-dialog-form").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi visita":function(){},Cancel:function(){$(this).dialog("close")}},close:function(){i.val("").removeClass("ui-state-error")}});$("#tp-button").button().click(function(){$("#tp-dialog-form").off("dialogopen").on("dialogopen",function(p){var n=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:n,height:m});p=p?p:window.event;var o=this;$(this).find("input").each(function(){$(this).val("")});$(this).find("input[id^=titolo]").focus();$(this).parent().find("button:contains(Aggiungi)").off("click").on("click",function(){var r=new Array();var t="";$(o).find("input").each(function(){r[this.id]=$(this).val();if(this.id.match(/^titolo/)){t=$(this).val()}});var s=$("#example");$("#example").handsontable("deselectCell");if($(o).find("input[id=numero-tp]").val()>0){var q=parseInt($(o).find("input[id=numero-tp]").val())}else{var q=parseInt($("#example").data("handsontable").getData()[0].length-10)}s.handsontable("alter","insert_col",(q-0));s.handsontable("setDataAtCell",0,(q-0),t);$("#tp-dialog-form").dialog("close")})});$("#tp-dialog-form").dialog("open")});$("#dialog-form-transfer").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi transfer price":function(){$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){i.val("").removeClass("ui-state-error")}});$("#dialog-form-prezzo").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi prezzo":function(){$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){i.val("").removeClass("ui-state-error")}});$("#prestazione-dialog-form").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi prestazione":function(){},Cancel:function(){$(this).dialog("close")}},open:function(){var n=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:n,height:m})},close:function(){i.val("").removeClass("ui-state-error")}});$("#prestazione-button").button().click(function(){$("#prestazione-dialog-form").dialog("open")});$("#dialog-form-CTC").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi markup":function(){formToElement("dialog-form-CTC",docObj.elements.budgetStudio);updatePrezzi(docObj.elements.budgetStudio.metadata.BudgetCTC_Markup);calcolaTotTabelle();calcolaTotali();$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){i.val("").removeClass("ui-state-error")}});$("#add-CTC").button().click(function(){elementToForm(docObj.elements.budgetStudio,"dialog-form-CTC");$("#dialog-form-CTC").dialog("open")});$("#dialog-form-n-pat").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{Applica:function(){formToElement("dialog-form-n-pat",docObj.elements.budgetStudio);var m=calcolaTotali();pazienti=docObj.elements.budgetStudio.metadata.BudgetCTC_NumeroPazienti;$("#show-n-pat").html(pazienti);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){i.val("").removeClass("ui-state-error")}});$("#add-n-pat").button().click(function(){elementToForm(docObj.elements.budgetStudio,"dialog-form-n-pat");$("#dialog-form-n-pat").dialog("open")});$("#dialog-form-target").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi target":function(){applyTargetForm();calcolaTotali();$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},open:function(){var n=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:n,height:m});prepareTargetForm(true)}});$("#create-target").button().click(function(){$("#dialog-form-target").dialog("open")});$("#clone-dialog-form").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Copia budget":function(){if(!$("#Budget_Versione").val()){alert("Attenzione. Inserire una versione per il nuovo budget.");return}var m={};$("#clone-dialog-form").find(":input").not("[name=clone_id]").each(function(){m[$(this).attr("name")]=$(this).val()});cloneObj($("#clone_id").val(),m)},Cancel:function(){$(this).dialog("close")}},open:function(){var n=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:n,height:m});prepareTargetForm(true)}});$("#clone2-dialog-form").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Copia budget":function(){if(!$("#Budget_Versione2").val()){alert("Attenzione. Inserire una versione per il nuovo budget.");return}var m={};$("#clone2-dialog-form").find(":input").not("[name=clone_id]").each(function(){m[$(this).attr("name")]=$(this).val()});cloneObj($("#clone_id2").val(),m,true)},Cancel:function(){$(this).dialog("close")}},open:function(){var n=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:n,height:m});prepareTargetForm(true)}});$("#newbudget-dialog-form").dialog({autoOpen:false,height:300,width:350,modal:true,position:{my:"center",at:"center top",of:document.getElementById("centerElement")},buttons:{"Aggiungi nuovo":function(){if(!$("#Budget_Versione3").val()){alert("Attenzione. Inserire una versione per il nuovo budget.");return}var m={};$("#newbudget-dialog-form").find(":input").each(function(){m[$(this).attr("name")]=$(this).val()});newBudgetStudio("newbudget-dialog-form")},Cancel:function(){$(this).dialog("close")}},open:function(){var n=$(window).width()/100*80;var m=$(window).height()/100*80;$(this).dialog("option",{width:n,height:m});prepareTargetForm(true)}})});